# ë¯¸ë¡œ (Miri)

*ë©‹ì©ê²Œ ì›ƒìŒ (nervously laughs)* ì´ unsafe ê¸°ëŠ¥ì€ ë§‰ìƒ í•´ë³´ë‹ˆ ë„ˆë¬´ ì‰½ë„¤ìš”, ëŒ€ì²´ ì™œ ë‹¤ë“¤ ê·¸ë ‡ê²Œ í˜¸ë“¤ê°‘ì¸ì§€ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤. ìš°ë¦¬ í”„ë¡œê·¸ë¨ì€ ì§€ê¸ˆ ì™„ë²½í•˜ê²Œ ëŒì•„ê°€ê³  ìˆê±°ë“ ìš”.

> **í•´ì„¤ì:** ğŸ™‚

...ë§ì£ ? (right?)

> **í•´ì„¤ì:** ğŸ™‚

ê¸€ì„ìš”, ìš°ë¦° ì§€ê¸ˆ `unsafe` ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ëŸ¬ì¡°ì°¨ ìš°ë¦¬ì˜ ì‹¤ìˆ˜ë¥¼ ëˆˆì¹˜ì±„ê³  ì¡ì•„ì¤„(catch mistakes) ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìš°ë¦¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤ì´ ì§€ê¸ˆ í‘œë©´ì ìœ¼ë¡œ ìš´ ì¢‹ê²Œ(happened to) ì˜ ë„ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì¼ ë¿, ë‚´ë¶€ì ìœ¼ë¡  ë¹„ê²°ì •ë¡ ì ì¸(non-deterministic) ë¬´ì–¸ê°€ë¥¼ í•˜ê³  ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´, ë¯¸ì •ì˜ ë™ì‘(Undefined Behavioury) ê°™ì€ ë”ì°í•œ ì§“ ë§ì´ì£ .

í•˜ì§€ë§Œ ë­˜ ì–´ì©Œê² ìŠµë‹ˆê¹Œ? ìš°ë¦¬ëŠ” ì´ë¯¸ ì°½ë¬¸ì„ ëœ¯ê³  rustc ì»´íŒŒì¼ëŸ¬ì˜ êµì‹¤ ë°–ìœ¼ë¡œ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤(snuck out). ì´ì   ì•„ë¬´ë„ ìš°ë¦´ ë„ì™€ì¤„ ìˆ˜ ì—†ì–´ìš”(No one can help us now).

...ì ê¹, ê³¨ëª©ê¸¸ ì € êµ¬ì„ì— ì„œ ìˆëŠ” ì € ìˆ˜ìƒí•œ(sketchy) ë…€ì„ì€ ëŒ€ì²´ ëˆ„êµ¬ì£ ?

*"ì–´ì´ ê¼¬ë§ˆ, Rust ì½”ë“œë¥¼ ì¢€ í†µì—­(interpret) í•´ë³´ê³  ì‹¶ì§€ ì•Šë‚˜?"*

ë­- ì•„ë‡¨? ê·¸ê²Œ ì™œìš”,

*"ì´ê±° ì™„ì „ ëë‚´ì¤€ë‹¤ê³ , ì´ ë…€ì„ì€ ë„¤ í”„ë¡œê·¸ë¨ì˜ ì‹¤ì œ ë™ì  ì‹¤í–‰(dynamic execution) ê³¼ì •ì´ Rust ë³¸ì—°ì˜ ë©”ëª¨ë¦¬ ëª¨ë¸ ì˜ë¯¸ë¡  ê·œìœ¨ì— ë¶€í•©í•˜ëŠ”ì§€ ì™„ë²½í•˜ê²Œ ê²€ì¦(validate)í•´ ì¤„ ìˆ˜ ìˆì§€. ì§„ì§œ ê¹œì§ ë†€ë„ ê±°ë‹¤..."*

ë„¤?

*"ì´ ë…€ì„ì´ ë„¤ê°€ ë¯¸ì •ì˜ ë™ì‘ì„ ì €ì§ˆë €ëŠ”ì§€ ì•ˆ ì €ì§ˆë €ëŠ”ì§€ ì™„ë²½í•˜ê²Œ ì¡ì•„ë‚´ ì¤€ë‹¨ ì†Œë¦¬ë‹¤."*

ë­ ì›í•˜ì‹ ë‹¤ë©´ ì¸í„°í”„ë¦¬í„° íˆ´ì¸ì§€ ë­”ì§€ ë”± í•œ ë²ˆ(*once*)ë§Œ ì†ëŠ” ì…ˆ ì¹˜ê³  ì¨ ë³´ê¸°ì•¼ í•˜ê² ìŠµë‹ˆë‹¤.

*"ë„ˆ rustup ì •ë„ëŠ” ê¹”ë ¤ ìˆì§€?"*

ë‹¹ì—°í•˜ì£ , ìµœì‹  Rust íˆ´ì²´ì¸ìœ¼ë¡œ ìœ ì§€í•˜ê¸° ìœ„í•´ ì ˆëŒ€ ë¹ ì§€ë©´ ì•ˆ ë  í•µì‹¬ íˆ´(*the* tool) ì•„ë‹™ë‹ˆê¹Œ!

```text
> rustup +nightly-2022-01-21 component add miri

info: syncing channel updates for 'nightly-2022-01-21-x86_64-pc-windows-msvc'
info: latest update on 2022-01-21, rust version 1.60.0-nightly (777bb86bc 2022-01-20)
info: downloading component 'cargo'
...
info: downloading component 'miri'
info: installing component 'miri'
```

ë°©ê¸ˆ ë‚´ ì»´í“¨í„°ì— ë¬´ìŠ¨ ì§“ì„ í•´ì„œ ë­˜ ê¹”ì•„ë‘”(install on my computer) ê±°ì£ !?

*"ì§„ì§œë°°ê¸° ë³´ë¬¼ì„± ì•½ ë©ì–´ë¦¬(The Good Stuff)ì§€"*

> **í•´ì„¤ì:** íˆ´ì²´ì¸ ë²„ì „ê³¼ ì–½í˜€ì„œ ë’·ë°°ê²½ì— ì¢€ ë³µì¡í•œ ì¼(weird stuff)ì´ ë²Œì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤.
> 
> ìš°ë¦¬ê°€ ì„¤ì¹˜í•œ íˆ´ `miri`ëŠ” rustc ì»´íŒŒì¼ëŸ¬ ë‚´ë¶€(internals)ì™€ ê¸´ë°€í•˜ê²Œ ìœ ì°© ê²°í•© ì—°ë™(works closely)ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, ì˜¤ì§ nightly íˆ´ì²´ì¸ í™˜ê²½ì—ì„œë§Œ ë™ì‘í•©ë‹ˆë‹¤.
> 
> ì € `+nightly-2022-01-21` í”Œë˜ê·¸ëŠ” `rustup`í•œí…Œ ë‹¹ì¥ ê·¸ë‚  ë‚ ì§œì— ê³ ì •ëœ íŠ¹ì • nightly íˆ´ì²´ì¸ ë²„ì „ì— ë§ëŠ” mirië¥¼ ì„¤ì¹˜í•˜ë¼ê³  ê°•ì œ ëª…ë ¹(tells rustup)í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤. êµ³ì´ íŠ¹ì • ë‚ ì§œë¡œ ë°•ì œí•œ ì´ìœ ëŠ”, ê°€ë” ì´ miri ë…€ì„ì´ ì»´íŒŒì¼ëŸ¬ì˜ ë°œì „ ì†ë„ë¥¼ ëª» ë§ì¶° ë¹Œë“œê°€ ê¹¨ì§€ê³  í‘í¬ ë‚˜ëŠ”(falls behind) nightly ì‹œê¸°ë“¤ì´ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë§Œì•½ ìš°ë¦¬ê°€ ì§€ì •í•œ ë²„ì „ì˜ íˆ´ì²´ì¸ì´ ì—†ë‹¤ë©´ rustupì´ ì•Œì•„ì„œ ìŠ¤ìŠ¤ë¡œ ì¸í„°ë„·ì—ì„œ ë‹¤ìš´ë¡œë“œ(automatically download)í•´ì„œ ì„¤ì¹˜í•´ ì¤„ ê²ë‹ˆë‹¤.
> 
> ì°¸ê³ ë¡œ 2022-01-21ì€ miriê°€ ì •ìƒì ìœ¼ë¡œ êµ´ëŸ¬ê°„ë‹¤ê³ (miri support) ì œê°€ ì§ì ‘ í™•ì¸í•œ nightly ë°•ì œ ë‚ ì§œì…ë‹ˆë‹¤. [ì´ ê³µì‹ í˜„í™©íŒ í˜ì´ì§€](https://rust-lang.github.io/rustup-components-history/)ì—ì„œë„ í™•ì¸í•  ìˆ˜ ìˆì£ . ì˜¤ëŠ˜ ì¢€ ìš´ì´ ì¢‹ì€ ê²ƒ ê°™ë‹¤(feeling lucky) ì‹¶ìœ¼ë©´ ê·¸ëƒ¥ `+nightly` ì³ì„œ ëª¨í—˜ì„ ë– ë‚˜ë³´ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.
> 
> ì•ìœ¼ë¡œ ìš°ë¦¬ê°€ `cargo miri`ë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤, ìš°ë¦° ë°˜ë“œì‹œ ì´ `+` ë¬¸ë²•ì„ ëŒ€ë™í•˜ì—¬ miriê°€ ê¹”ë ¤ìˆëŠ” íˆ´ì²´ì¸ ë²„ì „ì„ ëª…í™•íˆ ëª…ì‹œ(specify) í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ë§¤ë²ˆ íƒ€ì´í•‘ ì¹˜ê¸° ë²ˆê±°ë¡­ë‹¤ë©´, [`rustup override set`](https://rust-lang.github.io/rustup/overrides.html)ì„ ì¨ì„œ íŠ¹ì • ë””ë ‰í† ë¦¬ì— ê³ ì •í•´ë²„ë¦´ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```text
> cargo +nightly-2022-01-21 miri test

I will run `"cargo.exe" "install" "xargo"` to install
a recent enough xargo. Proceed? [Y/n]
```

ì•„ë‹ˆ ì  ì¥ ëŒ€ì²´ XARGOê°€ ë˜ ë­¡ë‹ˆê¹Œ?

*"ë‹¤ ê´œì°®ì•„, ë„ˆë¬´ ê±±ì •í•˜ì§€ ë§ˆ(don't worry about it)."*

```text
> y

    Updating crates.io index
  Installing xargo v0.3.24
...
I will run `"rustup" "component" "add" "rust-src"` to install 
the `rust-src` component for the selected toolchain. Proceed? [Y/n]
```

ì•„??? (UH???)

*"ì´ ì„¸ìƒì— ê·¸ ì•„ë¦„ë‹¤ìš´ Rust ì†ŒìŠ¤ ì½”ë“œ(Rust's source code) ì›ë³¸ ë³µì‚¬ë³¸ì„ ì†Œì¥í•˜ëŠ” ê±¸ ë§ˆë‹¤í•  ì´ê°€ ì–´ë”” ìˆê² ì–´?"*

```text
> y

info: downloading component 'rust-src'
info: installing component 'rust-src'
```

*"ì˜¤ì˜ˆ ì¤€ë¹„ ì™„ë£Œ(it's ready). ì ì´ì œ ì§„ë˜ë°°ê¸° ë³¸ ê²Œì„ ì‹œì‘ì´ë‹¤."*

```text
   Compiling lists v0.1.0 (C:\Users\ninte\dev\tmp\lists)
    Finished test [unoptimized + debuginfo] target(s) in 0.25s
     Running unittests (lists-5cc11d9ee5c3e924.exe)

error: Undefined Behavior: trying to reborrow for Unique at alloc84055, 
       but parent tag <209678> does not have an appropriate item in 
       the borrow stack

   --> \lib\rustlib\src\rust\library\core\src\option.rs:846:18
    |
846 |             Some(x) => Some(f(x)),
    |                  ^ trying to reborrow for Unique at alloc84055, 
    |                    but parent tag <209678> does not have an 
    |                    appropriate item in the borrow stack
    |
    = help: this indicates a potential bug in the program: 
      it performed an invalid operation, but the rules it 
      violated are still experimental
    = help: see https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md 
      for further information
...
error: aborting due to previous error
```

ì™€. ì´ ì˜¤ë¥˜ ì§„ì§œ ì¥ë‚œ ì•„ë‹ˆê²Œ ë”ì°í•˜ë„¤ìš”(one heck of an error).

*"ìº¬ì•„, ì € ë”ì°í•œ í˜•í¸ì—†ëŠ” ê²ƒ ë˜¥ë”ë¯¸ ê°™ì€ ì—ëŸ¬ ë©”ì‹œì§€ ëª¨ìŠµ ì¢€ ë´. ì§„ì§œ ë³´ë©´ ëˆˆë¬¼ ë‚˜ê²Œ ì§œë¦¿í•˜ì§€(You love to see it)."*

ê³ ... ê³ ë§™ìŠµë‹ˆë‹¤?

*"ì—¬ê¸° ë¤ìœ¼ë¡œ ì´ ì •ì‹ ê³¼ ì•½ ì—ìŠ¤íŠ¸ë¡œê² ì§„í†µì œ í•œ ë³‘(bottle of estradiol)ë„ ì±™ê²¨ ë‘¬, ë¶„ëª…íˆ ì¢€ ì´ë”° ë¨¸ë¦¬ í„°ì§ˆ ë•Œ ì ˆì‹¤íˆ í•„ìš”í• (gonna need it later) í…Œë‹ˆê¹Œ."*

ì ê¹ë§Œ ì™œìš”? ëŒ€ì²´ ë‚´ ë‡Œê°€ ë¬´ìŠ¨ ê¼´ì„ ë³´ê²Œ ë˜ê¸¸ë˜?

*"ë„ˆ ì§€ê¸ˆ ë‹¹ì¥ë¶€í„° ë©”ëª¨ë¦¬ ëª¨ë¸(memory models)ì´ë¼ëŠ” ì§€ì˜¥ ì‹¬ì—°ì˜ ì² í•™ê´€ì— ëª¸ ë°”ì³ ì¹˜ì—´í•˜ê²Œ ê³ ë¯¼(about to think about)í•´ì•¼ í•˜ê±°ë“ , ì´ ì „ë¬¸ê°€ ë§ì„ ë¯¿ì–´(trust me)."*

> **í•´ì„¤ì:** ê·¸ëŸ¬ê³¤ ì´ ìˆ˜ìƒì©ì€ ê³¨ëª©ê¸¸ ì—¬ìš°(fox) ë‘”ê°‘ ê´´ì¸ ë…€ì„ì€ êµ¬ë© ì†ìœ¼ë¡œ ëƒ…ë‹¤ ë„ë§ì³ë²„ë ¸ìŠµë‹ˆë‹¤(scampered). ì•ˆì“°ëŸ¬ìš´ ì €í¬ ì €ìëŠ” ë°©ê¸ˆ ì „ ìê¸° ëˆˆì•ì—ì„œ ë­ê°€ ë²ˆì© íœ˜ëª°ì•„ì¹œ ê±´ì§€ ìƒí™©ì„ ê°„ì‹ íˆ ì†Œí™”(process)í•˜ëŠë¼ ëª‡ ë¶„ê°„(several minutes) í•˜ì—¼ì—†ì´ í—ˆê³µë§Œ ë©í•˜ë‹ˆ ë°”ë¼ë³´ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

-------

ê·¸ ê³¨ëª©ê¸¸ ë§ˆì•½ ë°€ë§¤ ì—¬ìš°ë…€ì„ì€ ì œ ì„±ë³„ ì •ì²´ì„±ì„ ë§ì¶˜ ê²ƒë¿ë§Œ ì•„ë‹ˆë¼(right about more than just my gender) ë˜ í•œ ê°€ì§€ íŒ©íŠ¸ë¥¼ ê¸°ê°€ ë§‰íˆê²Œ ì ì¤‘ì‹œì¼°ìŠµë‹ˆë‹¤: miri ì´ ë…€ì„ì€ ì§„ì§œë°°ê¸° ë³´ë¬¼ì„± ì•½ìŸì´ íˆ¬ì•½í’ˆ(The Good Shit)ì´ë¼ëŠ” ì‚¬ì‹¤ ë§ì…ë‹ˆë‹¤.

ê·¸ëŸ¼ ëŒ€ì²´ [miri](https://github.com/rust-lang/miri)ë¼ëŠ” ë…€ì„ ì •ì²´ì„±(what *is*)ì´ ë­¡ë‹ˆê¹Œ?

> Rustì˜ ì¤‘ê°„ ì–¸ì–´(MIR)ë¥¼ í•´ì„í•´ì„œ ì‹œë®¬ë ˆì´ì…˜ìœ¼ë¡œ êµ´ë ¤ë³´ëŠ” ì‹¤í—˜ì ì¸ ì¸í„°í”„ë¦¬í„°(interpreter). ì–˜ëŠ” cargo í”„ë¡œì íŠ¸ì˜ ë°”ì´ë„ˆë¦¬ íŒŒí¸ì´ë‚˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë“¤ì„ ë‹¨ì¼ ì‹¤í–‰(run)ì‹œí‚¤ë©´ì„œ íŠ¹ì • ë¶€ë¥˜ì˜ ì¹˜ëª…ì ì¸ ë¯¸ì •ì˜ ë™ì‘(undefined behavior) í­íƒ„ë“¤ì„ ì¹¼ê°™ì´ ì ë°œí•´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
>
> * ë°°ì—´ ë°– ë¶ˆë²• ì¹¨ë²”(Out-of-bounds) ë° í• ë‹¹ í•´ì œëœ ì°Œêº¼ê¸° ë©”ëª¨ë¦¬ ì¬ì‚¬ìš©(use-after-free)
> * ì´ˆê¸°í™” ì•ˆ ëœ ë”ë¯¸ ë°ì´í„° ë¶ˆëŸ‰ í˜•í¸ì—†ëŠ” ê²ƒ ë¬´ë‹¨ ë‚¨ìš©(use of uninitialized data)
> * ë‚´ì¬ í•„ìˆ˜ ê·œì¹™ ìœ„ë°˜ (ë„ë‹¬ ë¶ˆëŠ¥ ë¸”ë¡ì¸ `unreachable_unchecked` ê°€ ëš«ë ¤ ì‹¤í–‰ë˜ê±°ë‚˜, ë²”ìœ„ê°€ ê²¹ì¹˜ëŠ”ë° ë»”ë»”í•˜ê²Œ `copy_nonoverlapping` ë³µì‚¬ í•¨ìˆ˜ë¥¼ ë‚¨ë°œí•˜ëŠ” ë“±ì˜ ë‚´ì¬ ê·œì¹™ ê¸°ë§Œ)
> * ë©”ëª¨ë¦¬ ì •ë ¬ ê¸°ì¤€ì— ë§ì§€ ì•ŠëŠ”(Not sufficiently aligned) ì—‰ë§ì§„ì°½ í¬ì¸í„° ë©”ëª¨ë¦¬ ë¬´ë‹¨ ì ‘ê·¼
> * ê·¼ë³¸ íƒ€ì… ê·œì¹™ íŒŒê´´(Violation of some basic type invariants) (ì˜ˆì»¨ëŒ€ ê°’ì´ 0ì´ë‚˜ 1ì´ ì•„ë‹Œ ë¶ˆëŸ‰ bool íƒ€ì…, ë˜ëŠ” íŒë³„ìê°€ ë°•ì‚´ ë‚œ í˜•í¸ì—†ëŠ” ê²ƒ enum ë°ì´í„°)
> * (ì‹¤í—˜ì‹¤ ê¸°ëŠ¥: Experimental) ìƒíƒœê³„ ì•ˆì „ì„ ì„ ê´€ì¥í•˜ëŠ”(governing) Stacked Borrows ì°¨ìš© ìŠ¤íƒ ëˆ„ì  ë™ê¸°í™” ê·œì¹™ ì „ë©´ ìœ„ë²•(Violations) ì €í•­ ì ë°œ
> * (ì‹¤í—˜ì‹¤ ê¸°ëŠ¥: Experimental) ë°°íƒ€ ì°¸ì¡° ë¬´ì‹œ ë°ì´í„° ë ˆì´ìŠ¤(Data races) ì¶©ëŒ ì ë°œ íŒë³„ (ë‹¨ ì•½í•œ ë©”ëª¨ë¦¬ ë¶€ì‘ìš© ì˜ˆì™¸)
>
> ë¤ìœ¼ë¡œ, MiriëŠ” ë©”ëª¨ë¦¬ ëˆ„ìˆ˜(memory leaks) êµ¬ë© ì ë°œê¹Œì§€ ë„ì™€ì¤ë‹ˆë‹¤: ì¦‰ í”„ë¡œê·¸ë¨ì˜ ëŸ°íƒ€ì„ ì‹¤í–‰ì´ ëª¨ì¡°ë¦¬ ëë‚œ ë’¤ì—ë„(at the end of the execution) ì—¬ì „íˆ í•´ì œë˜ì§€ ëª»í•˜ê³  ë°©ì¹˜ë˜ì–´ ë‚¨ê²¨ì§„ ë³‘ë“  í• ë‹¹ëœ ê³ ì•„ ë©”ëª¨ë¦¬ ì¢€ë¹„ ì¡°ê°ë“¤ ì¤‘, ê¸€ë¡œë²Œ ì •ì  ìŠ¤íƒœí‹± ë£¨íŠ¸(global static)ì—ì„œ ì§ì ‘ ë„ë‹¬í•  ì—°ê²°ì„ ë§ˆì € ëŠì–´ì§„ ì±„ ë¯¸ì•„ê°€ ëœ ë– ëŒì´ ë¶ˆë²• ë¬´ì—°ê³  ë°ì´í„° ì”í•´ë¬¼ ì‹œì²´ë“¤ì´ ìƒì¡´ ì¤‘íƒ ë‚¨ì•„ìˆë‹¤ë©´ ì¦‰ì‹œ Miriê°€ í™©ë‹¹í•œë“¯ ëˆ„ì  ì—ëŸ¬ í˜¸ë£¨ë¼ê¸°(raise an error) ê²½ê³ ë¥¼ ì§‘í–‰í•´ ì¤ë‹ˆë‹¤.
>
> ...
>
> í•˜ì§€ë§Œ ì ˆëŒ€ ë§ê°í•˜ì§€ ë§ì•„ì•¼ í•  ì¹˜ëª…ì  ì£¼ì˜ì‚¬í•­(be aware)ì´ ìˆìŠµë‹ˆë‹¤, ì‚¬ì‹¤ MiriëŠ” ë‹¹ì‹ ì˜ ë˜¥ êµ¬ë”ê¸° í”„ë¡œê·¸ë¨ì´ í„°ëœ¨ë¦¬ëŠ” ê·¸ ëª¨ë“  ìˆ˜ë§Œ ê°€ì§€ ì¢…ë¥˜ì˜ ë¯¸ì •ì˜ ë™ì‘(undefined behavior) ëŒ€ì°¸ì‚¬ ë²„ê·¸ë“¤ì„ 100% ëª¨ì¡°ë¦¬ ì™„ë²½íˆ ì ë°œí•´ ë‚šì•„ì±„ì§„(catch all cases) ëª»í• ë¿ë”ëŸ¬, ì„¸ìƒì˜ ëª¨ë“  ê¸°ê¸°ë¬˜ë¬˜í•œ í”„ë¡œê·¸ë¨ ë¡œì§ì„ ì™„ë²½ ë Œë”ë§ êµ¬ë™(cannot run all programs) ëŒë ¤ëŒˆ ìˆ˜ë„ ì—†ëŠ” ë§¹ì ì„ ê°€ì§‘ë‹ˆë‹¤.

ê°€ë³ê²Œ ì„¸ ì¤„ í•µì‹¬ ì •ë¦¬(TL;DR): MiriëŠ” ë„ˆì˜ ì½”ë“œë¥¼ ë™ì ìœ¼ë¡œ í•œ ì¤„ í•œ ì¤„ ë Œë”ë§ í•´ì„(interprets)í•˜ë©°, ëŸ°íƒ€ì„(at runtime) ì¤‘ì— ì½”ë“œê°€ ê¸ˆì§€ëœ ê·œì¹™ì„ ë¶€ìˆ˜ê³ (break the rules) ë¯¸ì •ì˜ ë™ì‘(Undefined Behaviour) ë²”ì£„ë¥¼ ì €ì§€ë¥´ëŠ” ìˆœê°„ ì ë°œí•´ ë‚´ëŠ” ê²½ì°°ì…ë‹ˆë‹¤. ì´ê±´ ë¬´ì²™ì´ë‚˜ í•„ìˆ˜ë¶ˆê°€ê²°(necessary)í•œ ì œì•½ ì²´ê³„ì¸ë°, ì• ë‹¹ì´ˆ ë¯¸ì •ì˜ ë™ì‘(Undefined Behaviour)ì´ë¼ëŠ” ë¶ˆë²• ì˜¤ë¥˜ í­íƒ„ì˜ ì§€ìƒ ë³¸ì§ˆ ì„±ê²© ìì²´ê°€ ê¸°ë³¸ì ìœ¼ë¡œ(generally) ì»´íŒŒì¼ íƒ€ì„ì´ ì•„ë‹ˆë¼ ì´ë ‡ë“¯ ê¼­ ëŸ°íƒ€ì„ ì¤‘ì— ì•¼ìƒì—ì„œ íŠ€ì–´ë‚˜ì˜¤ëŠ” ì¢…ìì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë­ ì§„ì‘ ì»´íŒŒì¼ íƒ€ì„(compile time) ì •ì  ì„¤ê³„ ë Œë” ì—‘ìŠ¤ë ˆì´ ë‹¨ê³„ì—ì„œ ë°”ë¡œ ì¡°ê¸° ì ë°œ(could be found)ë  ë§Œí•œ í•˜ì°®ì€ ì‹¤ìˆ˜ ìˆ˜ì¤€ì´ì—ˆë‹¤ë©´ì•¼, ìœ„ëŒ€í•˜ì‹  ì»´íŒŒì¼ëŸ¬ ë‹˜ê»˜ì„œ ì§„ì‘ ë¹Œë“œ ìŠ¤í†± ë¹ ê¾¸ ê°•í‡´ ë¦°ì¹˜ ì—ëŸ¬ ë‹¨ì£„(make it an error)ë¥¼ ì‹œì¼°ê² ì£ !

C ì§„ì˜ ì–¸ì–´ê¶Œì—ì„œ í”í•œ ubsan(UndefinedBehaviorSanitizer) ì´ë‚˜ tsan(ThreadSanitizer) ë“±ì†ì˜ ê²€ì—´ ë„êµ¬ ì¡ë‹¤êµ¬ë¦¬(tools)ì™€ ê½¤ ìµìˆ™í•˜ì‹œë‹¤ê³ (familiar)ìš”? ê·¸ëŸ¼ ë§ ë‹¤ í–ˆë„¤ìš”: Miri ì´ ë…€ì„ì€ ê·¸ ì¡ë‹¤í•œ ìœ í‹¸ ë„êµ¬ ë³‘ì •ë“¤ì„ ì‹¹ ë‹¤ í•œë° ë’¤ì£½ë°•ì£½ ë¯¹ìŠ¤ ì´ ìŠ¤ê¹Œ ê²°ì§‘ ë³‘í•© ì˜ëŒ ê²°í•© ìš°ì£¼ í†µí•©(all together) ìœµí•©ì‹œí‚¨, í›¨ì”¬ ì§€ë…íˆ ê°•ë°• ë³‘ì  ê·¹ì•… ì”í˜¹í•˜ê³  í•˜ë“œì½”ì–´í•œ ëŒ€ì™• ë¬´ê²°(more extreme) íŒì‚¬ë‹˜ì…ë‹ˆë‹¤.

-------

ì ì´ì œ ì”í˜¹í•œ ìˆ™ì²­ ë„êµ¬ ê²€ì—´ê´€ Miriê°€ í•™ìŠµìš© ë‹¨ê²€(knife. A learning knife)ì„ ìŒì‚°íˆ ê±°ë¨¸ì¥” ì±„ ìš°ë¦¬ë“¤ì˜ ìŠ¤ì¿¨ êµì‹¤ ì°½ë¬¸ ë„ˆë¨¸ ë°–ì—ì„œ ì´ë¹¨ ì•™ë¬¼ê³  ëŒ€ê¸° ë§¤ë³µ(hanging outside) íƒ€ëŠ” ì¤‘ì…ë‹ˆë‹¤.

ë§Œì•½ ìš°ë¦¬ê°€ Mirië‹˜ê»˜ ë¶€ë”” ë‚´ í˜•í¸ì—†ëŠ” ê²ƒ ê°™ì€ ì½”ë“œ ê²°ê³¼ë¬¼ì´ ë¬´íƒˆ ì•ˆì „í•œì§€ ë¶€ë”” ì‹¬íŒ ì‹¬ì‚¬ ì‹œí—˜ í‰ê°€ ì§„ë‹¨ íŒë… ê²€ì—´ í•´ì„(check our work) ë‹¨ì£„ ë°›ê¸°ë¥¼ í•˜ì‚¬ ì›í•œë‹¤ë©´ì•¼, ë‹¤ìŒì˜ ì£¼ë¬¸ì„ ì•”ì†¡í•˜ì—¬ ê·¸ë¶„ë“¤ì„ ì†Œí™˜ ì‹¬íŒ ë‹¨ìœ„ ì œë‹¨(interpret our test suite)ìœ¼ë¡œ ì¸ë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```text
> cargo +nightly-2022-01-21 miri test
```

ì¢‹ì†Œ ì ì´ì œ ë…€ì„ì´ ìš°ë¦¬ì˜ ì±…ìƒ í‘œë©´ ê°€ì£½ì„ ë¬´ìë¹„í•˜ê²Œ ê¸ê³  íŒŒë‚´ ê°ˆê²¨ í›„ë²¼ ìƒˆê¸´(carved into our desk) ê·¸ ë”ì°í•œ í˜‘ë°• íŒê²° ì—ëŸ¬ ë‚™ì¸ ë©”ì‹œì§€ì˜ ì†ëœ» ì§„ìƒì„ ë” ë°€ì°© í™•ëŒ€ ê¹Šìˆ™ ì§‘ìš”í•˜ê²Œ ë‹ë³´ê¸° ì„¸ë°€ ì •ë… ëŒ€ì¡°(take a closer look at) ê°ìƒí•´ ë³´ì£ :

```text
error: Undefined Behavior: trying to reborrow for Unique at alloc84055, but parent tag <209678> does not have an appropriate item in the borrow stack

   --> \lib\rustlib\src\rust\library\core\src\option.rs:846:18
    |
846 |             Some(x) => Some(f(x)),
    |                  ^ trying to reborrow for Unique at alloc84055, 
    |                    but parent tag <209678> does not have an 
    |                    appropriate item in the borrow stack
    |

    = help: this indicates a potential bug in the program: it 
      performed an invalid operation, but the rules it 
      violated are still experimental
    
    = help: see 
      https://github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md 
      for further information
```

ë­, ìš°ë¦¬ê°€ ê°œë˜¥ ì¹˜ëª…ì  ë¶ˆë²• íŒ¨ë¥œ ë³‘í¬ í˜•í¸ì—†ëŠ” ê²ƒ ì½”ë”© ì—ëŸ¬ ë²”ì£„(made an error)ë¥¼ ì§€ë ¸ë‹¨ ëˆˆë¬¼ ì°¸ì‚¬ íŒ©íŠ¸ ìì²´ë§Œí¼ì€ ë¼ˆì €ë¦¬ê²Œ ì•Œê² ëŠ”ë°, ê·¼ë° ì´ ë¹Œì–´ë¨¹ì„ íŒê²°ë¬¸ ì—ëŸ¬ ë©”ì‹œì§€ ëª¨ìŠµê°€ ë„ˆë¬´ ì  ì¥ ë‚œë°ì—†ëŠ” ì™¸ê³„ì–´ ëª¨ìˆœ ë‚œë¬´ ì¹´ì˜¤ìŠ¤ ì •ì‹ ë³‘ ê¸‰ í—›ì†Œë¦¬ ë³µì¡ í˜„í•™ ê¸°ë§Œ(confusing) ì˜¤ë¥˜ ë©”ì‹œì§€ë¼ ìˆ¨ì´ í„± ë§‰í™ë‹ˆë‹¤. ë­ ëŒ€ê´€ì ˆ ëŒ€ì²´ ì €ë…€ì„ "ì°¨ìš© ìŠ¤íƒ(borrow stack)" ì´ë€ ê°œë¼‰ë‹¤êµ¬ í—›ì†Œë¦¬ê°€ ëŒ€ì²´ ë¬´ìŠ¨(What's the) í•´ê´´ë§ì¸¡í•œ ëœ»ì´ëë‹ˆê¹Œ?

ëŒ€ì²´ ì € ì™¸ê³„ì–´ ì‹ ì¥ íŒê²°ì˜ ì‹¤ì²´ ì¡±ë³´ ì§„ìƒ ì˜ë¯¸ê°€ ë­”ì§€ ê·¸ ë‚´ë¶€ ë´‰ì¸ í¼ì¦ ì§„ì‹¤ ë‚´ë§‰ ì† íŒŒí—¤ì¹˜ê¸° ì‚¬ë³€ íƒ€íŒŒ í•´ì†Œ(figure that out) ì§„ë‹¨ ê³µì‘ì€ ë°”ë¡œ ë‹¤ìŒ ì†í¸ ì—°ì¬ ë‹¤ìŒ ì¥ì˜ íŒŒíŠ¸ ë‹¨ë½ì—ì„œ ì£¼ë¨¹êµ¬êµ¬ ì•¼ë¬´ì§€ê²Œ ëŒíŒŒ ì‹œë„ íŒŒë³´ë„ë¡ í•©ì‹œë‹¤.